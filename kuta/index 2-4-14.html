<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Category Mapping</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Olas Navigator">

    <!-- required styles -->
    <link href="library/assets/css/bootstrap.css" rel="stylesheet">
    <link href="library/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="library/css/styles.css" rel="stylesheet">
    
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
    
  </head>
  <body>
    
    <!-- header -->
    <div id="header" class="navbar">
      <div class="navbar-inner">
	<!-- company or app name -->
	<a class="brand hidden-phone" href="index.html">Kuta Admin 2.0.2</a>
	
	<!-- nav icons -->
	<ul class="nav">
	  
	  <li class="visible-phone">
	    <a href="#"><i class="icon-large icon-search"></i></a>
	  </li>
	  
	  <li>
	    <a href="#">
	      <i class="icon-large icon-globe"></i>
	    </a>
	  </li>
	  
	  <li>
	    <a href="#">
	      <i class="icon-large icon-envelope"></i>
	    </a>
	  </li>
	  
	  <li>
	    <a href="#">
	      <i class="icon-large icon-cog"></i>
	    </a>
	  </li>
	  
	</ul>
	
	<ul class="nav pull-right">
	  
	  <!-- dropdown user account -->
	  <li class="dropdown">
	    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
	      <i class="icon-large icon-user"></i>
	    </a>
	    
	    <ul class="dropdown-menu dropdown-user-account">
	      
	      <li class="account-img-container">
		<img class="thumb account-img" src="#" />
	      </li>
	      
	      <li class="account-info">
		<h3>User</h3>
		<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
		<p>
		  <a href="#">Edit</a> | <a href="#">Account Settings</a>
		</p>
	      </li>
	      
	      <li class="account-footer">
		<div class="row-fluid">
		  
		  <div class="span8">
		    <a class="btn btn-small btn-primary btn-flat" href="#">Change avatar</a>
		  </div>
		  
		  <div class="span4 align-right">
		    <a class="btn btn-small btn-danger btn-flat" href="#">Logout</a>
		  </div>
		  
		</div>									
	      </li>
	      
	    </ul>
	  </li>
	  <!-- ./ dropdown user account -->
	</ul>
	
	<!-- search form -->
	<form class="navbar-search pull-right hidden-phone" action="">
	  <input type="text" class="search-query span4" placeholder="search...">
	</form>
	<!-- ./ search form -->
      </div>
    </div>
    <!-- end header -->		
    
    <div id="left_layout">
      <!-- main content -->
      <div id="main_content" class="container-fluid">
	
	<!-- page heading -->
	<div class="page-heading">
	  
	  <h2 class="page-title muted">
	    <i class="icon-dashboard"></i> Dashboard
	  </h2>
	  
	  <div class="page-info hidden-phone">
	    <ul class="stats">
	      <li>
		<span class="large text-warning">2354</span>
		<span class="mini muted">visitors</span>
	      </li>
	      <li>
		<span class="large text-info">4523</span>
		<span class="mini muted">members</span>
	      </li>
	      <li>
		<span class="large text-success">5673</span>
		<span class="mini muted">orders</span>
	      </li>
	      <li>
		<span class="large text-error">15</span>
		<span class="mini muted">cancellation</span>
	      </li>
	    </ul>
	  </div>
	</div>
	<!-- ./ page heading -->
	
	<ul class="breadcrumb breadcrumb-main">
	  <li><a href="#">Home</a> <span class="divider"><i class="icon-caret-right"></i></span></li>
	  <li><a href="#">Main page</a> <span class="divider"><i class="icon-caret-right"></i></span></li>
	  <li class="text-info">Dashboard</li>
	</ul>

	<!-- 

	     DEVELOPER: 
	       All of your markup and script includes need to go
	     entirely inside of this "post wrapper" div.  

	-->
	<!-- post wrapper -->				
	<div class="row-fluid">
    
    <h1 id="app">Welcome</h1>
    <button id="testButton"> Test Button </button>
    
    <!-- Test links for URLrouter.js 
    <h2>These are test router links</h2>
    <ul>
        <li><a href="http://johntestarea.x10.mx/otw/kuta/index.html#/cse">CSE</a></li>
        <li><a href="http://johntestarea.x10.mx/otw/kuta/index.html#/categorystats">CATEGORY_STATS</a></li>
        <li><a href="http://johntestarea.x10.mx/otw/kuta/index.html#/category">CATEGORY</a></li>
        
    </ul> --> 
    
    <H1> Below is rendered by backbone.js </h1>
    
    <div id="CSEVIEW"></div>
    <div class="tree-area">
	    <div id="tree-container">
    		<h1> CSE CATEGORIES </h1>
	    	<div id="tree4" class="treeDiv"><p>dummy text</p></div>
		</div>
		<div id="tree-container">
			<h1> CATEGORY NAME </h1>
	    	<div id="tree5" class="treeDiv"><p>dummy text</p></div>
		</div>
    </div>
    
    <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
    <h1> below is rendered by jqTree and Jquery only. </h1>
    <!-- jqTree HTML --> 
    <div class="treeArea">
        <div id="tree-container">
            <h2>Category Name</h2><div id="tree1" class="treeDiv"></div>
        </div>
        <button id="mappingButton"> Mapping Button, inactive </button>
        <div id="tree-container">
            <h2>CSE Campaign Name</h2><div id="tree2" class="treeDiv"></div>
        </div>
        <div id="tree-container">
            <h2>Category Name</h2><div id="tree3" class="treeDiv"></div>
        </div>
    </div>
    <div class="mapArea">
        <p> This div will hold the mapArea </p>
    </div>
    <!-- Modernizer -->
    <script src="library/js/lib/modernizr-2.6.2.min.js"></script>
    <!--JQuery-->
    <!--This JQuery replaces the one at the bottom of the file. needed for jqTree -->
    <script type="text/javascript" src="library/js/lib/jquery-1.10.2.min.js"></script>
    <!--Backbone.js script files -->
	<script type="text/javascript" src="library/js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="library/js/lib/backbone-min.js"></script>
    <!--<script type="text/javascript" src="library/js/URLrouter.js"></script>-->
    <!--<script type="text/javascript" src="library/js/Rest.js"></script>-->
    
    <!--Backbone script files -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>

    <!--Tree Script Files -->
    <script src="library/js/lib/tree.jquery.js"></script>
    <script src="library/assets/js/jquery-cookie.js"></script>
    <link rel="stylesheet" href="library/css/jqtree.css"/>
	<!--CSS-->
	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css"/>
    
    
    <!-- test script templates -->
    <script type="text/template" id="template">
    
        <table class="table stripped">
            <thead><tr>
                <th>name</th>
                <th>id</th>
            </tr></thead>
            <tbody>
            	<% _.each(coll, function(line) { %>
        			<tr>
        				<td> <%= line.get('name') %></td>
        				<td> <%= line.get('id') %></td>
    				</tr>
            	<% }); %>


            </tbody>
        
        </table>
    
    </script>
    
    <!-- TEST SCRIPT FOR BACKBONE.JS -->
    <script>
        console.log("entering backbone script");
        //http://backbonejs-beginner.herokuapp.com/users
        //thoughts:
    	//	in the view.render function, generate a variable to hold the data for the tree
    	//	Then load the tree. The tree itself becomes the template.
        
        //cse view
        var cseView = Backbone.View.extend({
            el: '#CSEVIEW',
            
            render: function() {
                var that = this;
                var coll = that.collection;
                console.log('!CSE CONTENT!');
                
                coll.fetch({
                    success: function(coll) {
                        var template = _.template($('#template').html(), {coll: coll.models});
                        that.$el.html(template);
                    }
                })
                return this;
            }
        
        });
        
        //cse colection
        var cseList = Backbone.Collection.extend({
            url: "../api/v1.0/cse"
        });

        var TreeView = Backbone.View.extend( {
			el: '#tree4',

			collection: new cseList(),

			initialize: function() {
				//load jqTree
				console.log("TreeView initilize");
				$.getJSON('../api/v1.0/cse', function(data) {
					console.log("json data");
					console.log(data);
					$(this.el).tree({
			            data: data
			        });
				})
				//data = data.responseJSON;
				
			},

			render : function() {
				//load jqTree
				console.log("TreeView render");
				console.log(this.collection);
				var that = this
				this.collection.fetch({success: function(c, response) {
					var data = response;
					console.log("model data");
					console.log(data);
					console.log(this.el);
					$(that.el).tree({
				            data: data
			        });
		        }});
		        return this
			}
        });
        
        //declare the backbone router
        var Router = Backbone.Router.extend( {
            routes: {
                '': 'home' //The homepage
            }
        });

        var loadChild = function (tree, URL, event) {
            console.log("loadChild function");
            var node = event.node;
            console.log("parent: " + node.parent);
            if (node.children.length === 0) {
                tree.tree('loadDataFromUrl', URL + node.id, node, function() {
                    tree.tree('openNode', node);
                	console.log("loaded");});
            }
            //else { }
        }
    
    	console.log("declaring variables");

        var cse = new cseView();
        var cselist = new cseList();
        cselist.fetch();

        var catlist = new cseList();
        catlist.url = "../api/v1.0/categories";
        cse.collection = cselist;
        catlist.fetch();

        var testtree = new TreeView();
        testtree.collection = cselist;

        var testtree2 = new TreeView();
        testtree2.el = '#tree5';
        testtree2.collection = catlist;
        
        var router = new Router();
        router.on('route:home', function() {
            console.log("The home page has loaded.");
            cse.render();
            testtree.render();
            testtree2.render();
        })
        
        
        Backbone.history.start();
    
    	$(document).ready(function() {
            $(testtree.el).bind('tree.click', function(event) {
                loadChild($(testtree2.el), '../api/v1.0/csecategories/', event)}) 

            $(testtree2.el).bind('tree.click', function(event) {
                loadChild($(testtree.el), '../api/v1.0/category/', event);
            	console.log("Loading category tree");})
        });//bind the lazy-loading on-click events

    </script>
    
    
    
    
    
    <!-- Test Script for the tree functionality 
            This will be moved to a seperate .js file-->
    <script>
        var loadChild = function (tree, URL, event) {
                console.log("loadChild function");
                var node = event.node;
                console.log("parent: " + node.parent);
                if (node.children.length === 0) {
                    tree.tree('loadDataFromUrl', URL + node.id, node, function() {
                        tree.tree('openNode', node)});
                }
                //else { }
        } // lazy-loading on-click function
    
        $.getJSON('../api/v1.0/cse',
            function(data) {
                for(var node in data) {
                    data[node].load_on_demand = true;
                }; 
            }
        ); // Test the JSON import function
       
       $.getJSON('../api/v1.0/categories',
            function(data) {
                $('#tree1').tree({
                    dataUrl: "../api/v1.0/category/",
                    data: data
                });
            }
        ); // import for the categories file and tree1
        
        $.getJSON('../api/v1.0/cse',
            function(data) {
                $('#tree2').tree({
                    data: data
                });
            }
        ); // import for the cse file and tree2

        $(document).ready(function() {
            $("#tree1").bind('tree.click', function(event) {
                loadChild($("#tree1"), '../api/v1.0/category/', event)})
            
            $("#tree2").bind('tree.click', function(event) {
                loadChild($("#tree2"), '../api/v1.0/csecategories/', event)}) 
        });//bind the lazy-loading on-click events


        $("#testButton").bind('click', function() {             
            console.log($.getJSON('../api/v1.0/category/1'));
        }); //test button to test functionality
    </script>


    </div>
	<!-- ./ post wrapper -->
      </div>
      <!-- end main content -->
      
      <!-- sidebar -->
      <ul id="sidebar" class="nav nav-pills nav-stacked">
	<li class="avatar hidden-phone">
	  <a href="#">
	    <img src="#" />
	    <span></span>
	  </a>
	</li>
	<li class="active">
	  <a href="index.html">
	    <i class="micon-screen"></i>
	    <span class="hidden-phone">Dashboard</span>
	  </a>
	</li>
	<li class="dropdown">
	  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
	    <i class="micon-gift"></i>
	    <span class="hidden-phone">UI</span>
	  </a>
	  <ul class="dropdown-menu">
	    <li>
	      <a href="typography.html">
		<i class="icon-large icon-underline"></i> Typography
	      </a>
	    </li>
	    <li>
	      <a href="tables.html">
		<i class="icon-large icon-table"></i> Tables
	      </a>
	    </li>
	    <li>
	      <a href="buttons.html">
		<i class="icon-large icon-th"></i> Buttons
	      </a>
	    </li>
	    <li>
	      <a href="icons.html">
		<i class="icon-large icon-check-empty"></i> Icons
	      </a>
	    </li>
	    <li>
	      <a href="dropdowns.html">
		<i class="icon-large icon-sort"></i> Dropdowns
	      </a>
	    </li>
	    <li>
	      <a href="tabs.html">
		<i class="icon-large icon-columns"></i> Tabs
	      </a>
	    </li>
	    <li>
	      <a href="breadcrumbs-paginations.html">
		<i class="icon-large micon-loop"></i> Breadcrums & Paginations
	      </a>
	    </li>
	    <li>
	      <a href="alerts.html">
		<i class="icon-large micon-bell"></i> Alerts
	      </a>
	    </li>
	    <li>
	      <a href="progress-bars.html">
		<i class="icon-large micon-paragraph-left"></i> Progress Bars
	      </a>
	    </li>
	    <li>
	      <a href="pickers-sliders.html">
		<i class="icon-large micon-equalizer"></i> Pickers & Sliders
	      </a>
	    </li>
	    <li>
	      <a href="modals.html">
		<i class="icon-large micon-copy"></i> Modals
	      </a>
	    </li>
	  </ul>
	</li>
	<li>
	  <a href="charts.html">
	    <i class="micon-stats-up"></i>
	    <span class="hidden-phone">Charts</span>
	  </a>
	</li>
	<li>
	  <a href="maps.html">
	    <i class="micon-location"></i>
	    <span class="hidden-phone">Maps</span>
	  </a>
	</li>
	<li class="dropdown">
	  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
	    <i class="micon-checkbox"></i>
	    <span class="hidden-phone">Form</span>
	  </a>
	  <ul class="dropdown-menu">
	    <li>
	      <a href="form-elements.html">
		<i class="icon-large icon-th-large"></i> Form elements
	      </a>
	    </li>
	    <li>
	      <a href="form-input-sizes.html">
		<i class="icon-large icon-th-large"></i> Input Size
	      </a>
	    </li>
	    <li>
	      <a href="form-control-states.html">
		<i class="icon-large icon-th-large"></i> Form control states
	      </a>
	    </li>
	    <li>
	      <a href="wysiwyg.html">
		<i class="icon-large icon-th-large"></i> WYSIWYG
	      </a>
	    </li>
	  </ul>
	</li>
	<li>
	  <a href="widgets.html">
	    <i class="micon-lab"></i>
	    <span class="hidden-phone">Widgets</span>
	  </a>
	</li>
      </ul>
      <!-- end sidebar -->
    </div>
    
    <!-- external api -->
    <script src="http://maps.google.com/maps/api/js?v=3.5&sensor=false"></script>
    
    <!-- base -->
    <!--<script src="library/assets/js/jquery.js"></script>-->
    <script src="library/assets/js/bootstrap.min.js"></script>
    
    <!-- addons -->
    <script src="library/plugins/chart-plugins.js"></script>
    <script src="library/plugins/jquery-ui-slider.js"></script>
    <script src="library/plugins/redactor/redactor.min.js"></script>
    <script src="library/plugins/jmapping/markermanager.js"></script>
    <script src="library/plugins/jmapping/StyledMarker.js"></script>
    <script src="library/plugins/jmapping/jquery.metadata.js"></script>
    <script src="library/plugins/jmapping/jquery.jmapping.min.js"></script>
    <script src="library/plugins/jquery.uniform.js"></script>
    <script src="library/plugins/chosen.jquery.min.js"></script>
    <script src="library/plugins/bootstrap-datepicker.js"></script>
    <script src="library/plugins/jquery.timePicker.min.js"></script>
    
    <!-- plugins loader -->
    <script src="library/js/loader.js"></script>
  </body>
</html>
